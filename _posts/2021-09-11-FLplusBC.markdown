---
layout: post
title: "Look Foward to Blockchain Intergrated Federated Learning"
subtitle: "一些关于BC+FL的展望"
date: 2021-09-11
author: Krad
category: Blockchain
tags: blockchain FL
finished: true
published: false
---

## 前言

近两年不断有联邦学习（Federated Learning）与区块链技术(Blockchain Technology)相结合的工作出现。本人在这两方面均有涉猎，在这里想谈论下BC+FL在未来实际应用的可能性。本文主要从宏观的角度说说我自己的理解，基本上写到哪儿说到哪儿，定有疏忽还望海涵，当然任何形式的友好交流都是受欢迎的。

## Why BC + FL?

自从BC+FL的idea提出，相当一部分社区研究者们从各个方向给出了自己的结合方案。很多BC+FL的文章作者，往往会谈及BC与FL同为分布式系统，认为使用BC来保证FL中的信息交流与储存安全具有先天的优越性。这类文章通常会避开分析BC为FL系统带来的很多额外消耗，着重讨论BC如何安全且不可更改地保存FL中的学习模型，如何保证模型交换与传输的隐私性（privacy）与权威性（authenticity）。然而，就我看来这类文章更像是在讲一个美丽的故事，所谓的安全性是由区块链的数据冗余带来的，而隐私性等不过是使用了区块链中的非对称密钥技术而已，这些问题完全可以将区块链中的一小部分技术单独取出进行解决。相反，一味地套用区块链，反而会因为共识机制的引入为整个FL系统带来大量额外消耗。

就我个人而言，BC与FL相结合并没有什么先天优势可谈，BC技术的最重要的一个特点就是去中心化。不幸的是，当今较为实用的FL系统通常是由一个中心服务器与复数个FL参与节点构成的，这恰恰与BC中提及的去中心化背道而驰。介于此，有一大部分的BC+FL工作在将两者结合时呈现出一种分离感，BC被当作一种API在使用，BC与FL的底层原理与算法根本没有交融。

现今阶段BC的理论技术趋于成熟，业界的讨论重心移至应用与落地，BC+FL本身也只是一次试错。就试错而言，我觉得应该允许BC+FL的初期研究工作不注重BC带来的额外消耗，而将目光聚焦于利用BC特性解决FL中的各种困境。但是回过头来，BC+FL的研究自2018算起（以Blockchained On-Device Federated Learning这篇文章为代表）也已经过了三年，随着FL领域的分类更加明了清晰，研究更加深入，是时候细化地根据不同FL场景研究BC加持的可能性与方式，同时应该深入到BC与FL的底层原理与算法，实现算法层面上的结合，尽量减少BC引入带来的额外开销。


## 现存研究方向浅谈与评价

既然提到细化研究方向，我们便从FL的不同分类开始讲起。

FL自2017年被Google提出后才受到广泛关注，在此之前FL的别名有许多（e.g. Collaborative Learning， Distributed Optimization...）。根据最新的研究讨论（Advances and Open Problems in Federated Learning，2021.3新发布版），社区普遍将FL分为三类，第一类为分布式学习或者叫并行学习（Datacenter distributed learning），第二类为组织间学习（Cross-silo federated learning），第三类为设备端学习（Cross-device federated learning）。其中第一类FL通过将数据中心的数据分配给FL参与者完成学习，其目的是为了提高模型学习的效率，与传统的分布式学习最为相近。第二类与第三类FL中数据都是本就存在于FL参与者的，这些数据涉及私密性不能够直接地进行交流与聚集，形成了一个又一个数据孤岛，联邦学习通过传递本地训练得到的机器学习模型进行聚合实现机器学习模型的训练数据扩充与准确率提高。第二类与第三类学习的区别在于，组织间的联邦学习中参与者数量较少（通常5个就算比较多了）但是每个参与者上的数据较多,每个参与者会重复参与多次联邦学习的循环，可以进行纵向与横向的学习（自行百度）；而设备端上的学习参与节点为众多的移动设备或者说物联网设备，每个参与节点的训练数据数量可能不同，质量也不相同，同时必须考虑每个设备节点的异质性，即不同的计算性能、电池电量、通信情况、网络情况等，这些节点在参与联邦学习时表现出不稳定的特点（通常假设至少有5%的设备在一次联邦学习训练中不能完成任务）。

想要利用BC的特性解决FL的问题，显然第三类FL的机会更多。对于第一类FL而言，区块链的加入会拖慢系统效率与其目的不符；对于第二类FL而言，区块链的安全性保证与区块链系统的参与节点数目有着很大关联，节点数目较少时区块链系统不稳定且效率低下。介于此，后文的讨论也仅仅包括BC在第三类即设备端FL的结合应用。

现阶段的工作文献主要从三个方向为FL引入BC，概括如下：
* 数据安全存储与传输。
* 激励机制。
* 共识算法。

以下分点进行详细讨论。

### 数据安全存储与传输

对于FL系统中的数据安全分为模型的储存安全与模型的传输安全。

在FL中模型分为本地模型与全局模型，本地模型即FL参与节点在本地用本地数据训练得到，而全局模型则是由中心服务器收集FL参与节点的本地模型后聚合而成。将本地模型作为交易信息（Transaction）储存在区块（Block）中，随着区块链的延伸，通过分布式的冗余存储，每个FL参与者上传的本地模型以及以此聚集的全局模型将不可篡改，这也使得任意一次模型训练都可以溯源，这也即是模型存储安全的体现。这里存在一个争议点，即存储所有的本地模型是否有意义。一部分人认为记录完整的模型参数进入区块中是有意义的，原因为两点1.联邦学习存在达到最优训练次数后继续学习，模型准确率开始下降的可能性，保留完整的模型数据便于回滚；2.保留完整的模型数据才能够实现溯源，为惩罚恶意节点以及奖励优质节点提供依据。另一部分人则认为模型参数文件占据大量存储空间（ResNet18的一个本地模型参数导出差不多30+MB），只需要保留模型参与联邦学习上传本地模型的记录即可。我认为如果不保留模型参数，如前文所说，BC与FL始终是分离的，这种结合方式在Fabric上写个智能合约很快就能实现。为了减少模型参数的数据大小，很多文章喜欢提及存储梯度以代替模型参数，或者优化学习模型框架使得只提取模型参数，但我认为这样的提升都是不明显的，设备端的联邦学习需要经过上万次训练迭代，而且很多设备的存储空间极其有限的。一种折中的方法是将模型参数作为交易信息的body，而参与训练的记录在在交易信息的head里，然后每隔一段时间剔除老旧区块中的交易信息的body，只保留head。

对于模型的传输安全，FL本地模型在作为交易信息进行传输时也会运用到区块链的密码学技术，匿名情况下实现对模型的权威性认证。一些文章谈及的身份认证机制也可以被归为BC加持的传输安全成问题，其核心技术就是非对称密钥技术。以我拙见，大多数这类工作完全可以抛开BC不谈，直接深入到所涉及的密码学方法。总的来说，这个方可以再观望一下。

### 激励机制

激励机制是最早吸引研究者们为设备端FL引入BC的原因之一，因为设备端FL的早期主要困境之一就在于设备没有动机消耗计算与通信资源参与联邦学习。可惜的是，这方面的早期研究普遍太理想化了，不得不说，很多做FL研究的人是真的像从来没有实际部署过FL。这些研究都挺喜欢讲故事的，总结一下基本都是考虑到区块链中的矿工进行挖矿可以获得奖励，我们希望利用这一激励机制来激励FL中的参与者。在其各种复杂的算法与公式推导后，往往会发现他所谓的激励机制不过是使用区块链记录了下FL参与者的模型上传记录来实现最后的统计分配，与区块链的挖矿奖励几乎没有关系，可以说是本末倒置了。那么FL还能从激励机制方向来引入BC吗？我的答案是肯定的，只是研究方向应该深入到区块链的挖矿机制，深入到共识算法中去。

### 共识算法

想要
，

显然，

联邦学习中没有矿工的概念，每个联邦学习参与者是平等的，同时中央



首先是中介剔除，在BC+FL的文章中常常会谈到单点故障问题，认为FL中的中心服务器的故障将会给整个FL网络带来毁灭性的打击，那么利用区块链技术中的密码学技术与共识机制建立去中心（或者弱中心）的网络系统结构可以赋予FL参与节点相对平等的地位，避免单点故障带来重大损失。

利用区块链技术可以实现数据的全存储与传输，这是由于区块链中的数据无法更改，同时由于密码学的加持，网络中传输的数据可以保证权威性避免篡改。利用这一特点，很多FL的文章利用区块链技术实现本地模型的安全传输及存储。

区块链技术在去中介的同时引入了激励机制，通过奖励自发维护区块链网络的节点来保证区块链网络可以一直延续下去。将BC与FL相结合，可以引入激励机制来保证FL参与节点的积极性。

尽管BC在解决上述问题时确实存在先天的优越性，但是存在着一个致命缺陷就是BC的共识机制将会带来额外资源消耗，而相关研究其实也就是在做一种trade off。


将BC与FL结合并不像它们表面的特性那样水到渠成，事实上FL的系统架构在诸多地方与BC相斥。一个最简单的例子就是常见的FL通常沿用Google在2017年提出的框架，也就是一种中心


## 总结
